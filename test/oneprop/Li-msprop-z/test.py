#!/usr/bin/env python
#
# Test: one-electron property operator (magnetic hyperfine) included
# through the 'oneprop' keyword
#

import sys
import os

sys.path.append(os.path.join(os.path.dirname(__file__), '../../'))
from minitest import Test, Filter, execute, DIRAC_PATH

print('>>> oneprop/Li atom model-space properties')

dirac_inp = "TRA.inp"
dirac_mol = "Li.mol"
execute(DIRAC_PATH + " --nobackup --noarch --inp=" + dirac_inp + " --mol=" + dirac_mol + " --get=\"MRCONEE MDCINT MDPROP\"")

# Transition dipole moments (the 'mstdm' option)
Test("mstdm", "cc_mstdm.inp", filters=[
    Filter("Total SCF energy = ",         -7.23720113394432, 1e-7),
    Filter("MP2 correlation energy = ",     -0.037127930756, 1e-7),
    Filter("Total MP2 energy = ",         -7.27432906470000, 1e-7),
    Filter("CCSD correlation energy = ",    -0.041240544312, 1e-7),
    Filter("@    1", -0.1979693711, 1e-7),
    Filter("@    2", -0.1296541879, 1e-7),
    Filter("@    3", -0.1296513218, 1e-7),
    Filter("1 (1/2+) ->  2 (1/2+)", [    0.00, 14993.45, 1.373428, 0.085909, 0.000000, 0.000000, 1.373428], [1e-2,1e-2,1e-5,1e-5,1e-5,1e-5,1e-5]),
    Filter("1 (1/2+) ->  3 (1/2+)", [    0.00, 14994.08, 1.942337, 0.171828, 0.000000, 0.000000, 1.942337], [1e-2,1e-2,1e-5,1e-5,1e-5,1e-5,1e-5]),
    Filter("2 (1/2+) ->  1 (1/2+)", [14993.45,     0.00, 1.373428, 0.085909, 0.000000, 0.000000, 1.373428], [1e-2,1e-2,1e-5,1e-5,1e-5,1e-5,1e-5]),
    Filter("3 (1/2+) ->  1 (1/2+)", [14994.08,     0.00, 1.942337, 0.171828, 0.000000, 0.000000, 1.942337], [1e-2,1e-2,1e-5,1e-5,1e-5,1e-5,1e-5]),
    Filter("1 (1/2+) ->  2 (1/2-)", [    0.00, 14993.45, 1.942321, 0.171818, 1.373428, 1.373428, 0.000000], [1e-2,1e-2,1e-5,1e-5,1e-5,1e-5,1e-5]),
    Filter("1 (1/2+) ->  3 (1/2-)", [    0.00, 14994.08, 1.373440, 0.085914, 0.971168, 0.971168, 0.000000], [1e-2,1e-2,1e-5,1e-5,1e-5,1e-5,1e-5]),
    Filter("2 (1/2+) ->  1 (1/2-)", [14993.45,     0.00, 1.942321, 0.171818, 1.373428, 1.373428, 0.000000], [1e-2,1e-2,1e-5,1e-5,1e-5,1e-5,1e-5]),
    Filter("3 (1/2+) ->  1 (1/2-)", [14994.08,     0.00, 1.373440, 0.085914, 0.971168, 0.971168, 0.000000], [1e-2,1e-2,1e-5,1e-5,1e-5,1e-5,1e-5]),
    Filter("1 (1/2+) ->  1 (3/2+)", [    0.00, 14994.08, 2.378867, 0.257742, 1.682113, 1.682113, 0.000000], [1e-2,1e-2,1e-5,1e-5,1e-5,1e-5,1e-5]),
    Filter("1 (1/2-) ->  2 (1/2+)", [    0.00, 14993.45, 1.942321, 0.171818, 1.373428, 1.373428, 0.000000], [1e-2,1e-2,1e-5,1e-5,1e-5,1e-5,1e-5]),
    Filter("1 (1/2-) ->  3 (1/2+)", [    0.00, 14994.08, 1.373440, 0.085914, 0.971168, 0.971168, 0.000000], [1e-2,1e-2,1e-5,1e-5,1e-5,1e-5,1e-5]),
    Filter("2 (1/2-) ->  1 (1/2+)", [14993.45,     0.00, 1.942321, 0.171818, 1.373428, 1.373428, 0.000000], [1e-2,1e-2,1e-5,1e-5,1e-5,1e-5,1e-5]),
    Filter("3 (1/2-) ->  1 (1/2+)", [14994.08,     0.00, 1.373440, 0.085914, 0.971168, 0.971168, 0.000000], [1e-2,1e-2,1e-5,1e-5,1e-5,1e-5,1e-5]),
    Filter("1 (1/2-) ->  2 (1/2-)", [    0.00, 14993.45, 1.373428, 0.085909, 0.000000, 0.000000, 1.373428], [1e-2,1e-2,1e-5,1e-5,1e-5,1e-5,1e-5]),
    Filter("1 (1/2-) ->  3 (1/2-)", [    0.00, 14994.08, 1.942337, 0.171828, 0.000000, 0.000000, 1.942337], [1e-2,1e-2,1e-5,1e-5,1e-5,1e-5,1e-5]),
    Filter("2 (1/2-) ->  1 (1/2-)", [14993.45,     0.00, 1.373428, 0.085909, 0.000000, 0.000000, 1.373428], [1e-2,1e-2,1e-5,1e-5,1e-5,1e-5,1e-5]),
    Filter("3 (1/2-) ->  1 (1/2-)", [14994.08,     0.00, 1.942337, 0.171828, 0.000000, 0.000000, 1.942337], [1e-2,1e-2,1e-5,1e-5,1e-5,1e-5,1e-5]),
    Filter("1 (1/2-) ->  1 (3/2-)", [    0.00, 14994.08, 2.378867, 0.257742, 1.682113, 1.682113, 0.000000], [1e-2,1e-2,1e-5,1e-5,1e-5,1e-5,1e-5]),
    Filter("1 (3/2+) ->  1 (1/2+)", [14994.08,     0.00, 2.378867, 0.257742, 1.682113, 1.682113, 0.000000], [1e-2,1e-2,1e-5,1e-5,1e-5,1e-5,1e-5]),
    Filter("1 (3/2-) ->  1 (1/2-)", [14994.08,     0.00, 2.378867, 0.257742, 1.682113, 1.682113, 0.000000], [1e-2,1e-2,1e-5,1e-5,1e-5,1e-5,1e-5])
]).run(options="--no-clean")

# Transition dipole moments -- X component
# (the 'msprop' option)
Test("dipole moment x", "cc_xdiplen.inp", filters=[
    Filter("1 (1/2+) ->  2 (1/2-)", [    0.00, 14993.45, -1.373428, 0.000000, 1.373428], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (1/2+) ->  3 (1/2-)", [    0.00, 14994.08, -0.971168, 0.000000, 0.971168], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("2 (1/2+) ->  1 (1/2-)", [14993.45,     0.00,  1.373428, 0.000000, 1.373428], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("3 (1/2+) ->  1 (1/2-)", [14994.08,     0.00,  0.971168, 0.000000, 0.971168], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (1/2+) ->  1 (3/2+)", [    0.00, 14994.08,  1.682113, 0.000000, 1.682113], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (1/2-) ->  2 (1/2+)", [    0.00, 14993.45,  1.373428, 0.000000, 1.373428], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (1/2-) ->  3 (1/2+)", [    0.00, 14994.08,  0.971168, 0.000000, 0.971168], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("2 (1/2-) ->  1 (1/2+)", [14993.45,     0.00, -1.373428, 0.000000, 1.373428], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("3 (1/2-) ->  1 (1/2+)", [14994.08,     0.00, -0.971168, 0.000000, 0.971168], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (1/2-) ->  1 (3/2-)", [    0.00, 14994.08, -1.682113, 0.000000, 1.682113], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (3/2+) ->  1 (1/2+)", [14994.08,     0.00,  1.682113, 0.000000, 1.682113], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (3/2-) ->  1 (1/2-)", [14994.08,     0.00, -1.682113, 0.000000, 1.682113], [1e-2,1e-2,1e-5,1e-5,1e-5])
]).run("--no-clean")

# Transition dipole moments -- Y component
Test("dipole moment y", "cc_ydiplen.inp", filters=[
    Filter("1 (1/2+) ->  2 (1/2-)", [    0.00, 14993.45, 0.000000, -1.373428, 1.373428], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (1/2+) ->  3 (1/2-)", [    0.00, 14994.08, 0.000000, -0.971168, 0.971168], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("2 (1/2+) ->  1 (1/2-)", [14993.45,     0.00, 0.000000,  1.373428, 1.373428], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("3 (1/2+) ->  1 (1/2-)", [14994.08,     0.00, 0.000000,  0.971168, 0.971168], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (1/2+) ->  1 (3/2+)", [    0.00, 14994.08, 0.000000, -1.682113, 1.682113], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (1/2-) ->  2 (1/2+)", [    0.00, 14993.45, 0.000000, -1.373428, 1.373428], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (1/2-) ->  3 (1/2+)", [    0.00, 14994.08, 0.000000, -0.971168, 0.971168], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("2 (1/2-) ->  1 (1/2+)", [14993.45,     0.00, 0.000000,  1.373428, 1.373428], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("3 (1/2-) ->  1 (1/2+)", [14994.08,     0.00, 0.000000,  0.971168, 0.971168], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (1/2-) ->  1 (3/2-)", [    0.00, 14994.08, 0.000000, -1.682113, 1.682113], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (3/2+) ->  1 (1/2+)", [14994.08,     0.00, 0.000000,  1.682113, 1.682113], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (3/2-) ->  1 (1/2-)", [14994.08,     0.00, 0.000000,  1.682113, 1.682113], [1e-2,1e-2,1e-5,1e-5,1e-5])
]).run("--no-clean")

# Transition dipole moments -- Z component
Test("dipole moment z", "cc_zdiplen.inp", filters=[
    Filter("1 (1/2+) ->  2 (1/2+)", [    0.00, 14993.45, 1.373428,  0.000000, 1.373428], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (1/2+) ->  3 (1/2+)", [    0.00, 14994.08,-1.942337,  0.000000, 1.942337], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("2 (1/2+) ->  1 (1/2+)", [14993.45,     0.00, 1.373428,  0.000000, 1.373428], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("3 (1/2+) ->  1 (1/2+)", [14994.08,     0.00,-1.942337,  0.000000, 1.942337], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (1/2-) ->  2 (1/2-)", [    0.00, 14993.45, 1.373428,  0.000000, 1.373428], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (1/2-) ->  3 (1/2-)", [    0.00, 14994.08,-1.942337,  0.000000, 1.942337], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("2 (1/2-) ->  1 (1/2-)", [14993.45,     0.00, 1.373428,  0.000000, 1.373428], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("3 (1/2-) ->  1 (1/2-)", [14994.08,     0.00,-1.942337,  0.000000, 1.942337], [1e-2,1e-2,1e-5,1e-5,1e-5])
]).run("--no-clean")

# Hyperfine structure matrix elements -- X component
Test("hfs constant x", "cc_xhfs.inp", filters=[
    Filter("1 (1/2+) ->  1 (1/2-)", [    0.00,     0.00,-64.874846, 0.000000,64.874846], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("2 (1/2+) ->  2 (1/2-)", [14993.45, 14993.45,  7.426794, 0.000000, 7.426794], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("2 (1/2+) ->  3 (1/2-)", [14993.45, 14994.08, -0.656325, 0.000000, 0.656325], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("3 (1/2+) ->  2 (1/2-)", [14994.08, 14993.45, -0.656325, 0.000000, 0.656325], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("3 (1/2+) ->  3 (1/2-)", [14994.08, 14994.08, -2.970035, 0.000000, 2.970035], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("2 (1/2+) ->  1 (3/2+)", [14993.45, 14994.08,  1.136788, 0.000000, 1.136788], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("3 (1/2+) ->  1 (3/2+)", [14994.08, 14994.08, -2.572125, 0.000000, 2.572125], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (1/2-) ->  1 (1/2+)", [    0.00,     0.00,-64.874846, 0.000000,64.874846], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("2 (1/2-) ->  2 (1/2+)", [14993.45, 14993.45,  7.426794, 0.000000, 7.426794], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("2 (1/2-) ->  3 (1/2+)", [14993.45, 14994.08, -0.656325, 0.000000, 0.656325], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("3 (1/2-) ->  2 (1/2+)", [14994.08, 14993.45, -0.656325, 0.000000, 0.656325], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("3 (1/2-) ->  3 (1/2+)", [14994.08, 14994.08, -2.970035, 0.000000, 2.970035], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("2 (1/2-) ->  1 (3/2-)", [14993.45, 14994.08,  1.136788, 0.000000, 1.136788], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("3 (1/2-) ->  1 (3/2-)", [14994.08, 14994.08, -2.572125, 0.000000, 2.572125], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (3/2+) ->  2 (1/2+)", [14994.08, 14993.45,  1.136788, 0.000000, 1.136788], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (3/2+) ->  3 (1/2+)", [14994.08, 14994.08, -2.572125, 0.000000, 2.572125], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (3/2-) ->  2 (1/2-)", [14994.08, 14993.45,  1.136788, 0.000000, 1.136788], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (3/2-) ->  3 (1/2-)", [14994.08, 14994.08, -2.572125, 0.000000, 2.572125], [1e-2,1e-2,1e-5,1e-5,1e-5])
]).run("--no-clean")

# Hyperfine structure matrix elements -- Y component
Test("hfs constant y", "cc_yhfs.inp", filters=[
    Filter("1 (1/2+) ->  1 (1/2-)", [    0.00,     0.00, 0.000000, 64.874846,64.874846], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("2 (1/2+) ->  2 (1/2-)", [14993.45, 14993.45, 0.000000, -7.426794, 7.426794], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("2 (1/2+) ->  3 (1/2-)", [14993.45, 14994.08, 0.000000,  0.656325, 0.656325], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("3 (1/2+) ->  2 (1/2-)", [14994.08, 14993.45, 0.000000,  0.656325, 0.656325], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("3 (1/2+) ->  3 (1/2-)", [14994.08, 14994.08, 0.000000,  2.970035, 2.970035], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("2 (1/2+) ->  1 (3/2+)", [14993.45, 14994.08, 0.000000,  1.136788, 1.136788], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("3 (1/2+) ->  1 (3/2+)", [14994.08, 14994.08, 0.000000, -2.572125, 2.572125], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (1/2-) ->  1 (1/2+)", [    0.00,     0.00, 0.000000,-64.874846,64.874846], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("2 (1/2-) ->  2 (1/2+)", [14993.45, 14993.45, 0.000000,  7.426794, 7.426794], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("2 (1/2-) ->  3 (1/2+)", [14993.45, 14994.08, 0.000000, -0.656325, 0.656325], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("3 (1/2-) ->  2 (1/2+)", [14994.08, 14993.45, 0.000000, -0.656325, 0.656325], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("3 (1/2-) ->  3 (1/2+)", [14994.08, 14994.08, 0.000000, -2.970035, 2.970035], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("2 (1/2-) ->  1 (3/2-)", [14993.45, 14994.08, 0.000000, -1.136788, 1.136788], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("3 (1/2-) ->  1 (3/2-)", [14994.08, 14994.08, 0.000000,  2.572125, 2.572125], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (3/2+) ->  2 (1/2+)", [14994.08, 14993.45, 0.000000, -1.136788, 1.136788], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (3/2+) ->  3 (1/2+)", [14994.08, 14994.08, 0.000000,  2.572125, 2.572125], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (3/2-) ->  2 (1/2-)", [14994.08, 14993.45, 0.000000,  1.136788, 1.136788], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (3/2-) ->  3 (1/2-)", [14994.08, 14994.08, 0.000000, -2.572125, 2.572125], [1e-2,1e-2,1e-5,1e-5,1e-5])
]).run("--no-clean")

# Hyperfine structure matrix elements -- Z component
Test("hfs constant z", "cc_zhfs.inp", filters=[
    Filter("1 (1/2+) ->  1 (1/2+)", [    0.00,     0.00,-64.874846, 0.000000,64.874846], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("2 (1/2+) ->  2 (1/2+)", [14993.45, 14993.45, -7.426794, 0.000000, 7.426794], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("2 (1/2+) ->  3 (1/2+)", [14993.45, 14994.08, -1.312650, 0.000000, 1.312650], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("3 (1/2+) ->  2 (1/2+)", [14994.08, 14993.45, -1.312650, 0.000000, 1.312650], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("3 (1/2+) ->  3 (1/2+)", [14994.08, 14994.08, -1.485017, 0.000000, 1.485017], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (1/2-) ->  1 (1/2-)", [    0.00,     0.00, 64.874846, 0.000000,64.874846], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("2 (1/2-) ->  2 (1/2-)", [14993.45, 14993.45,  7.426794, 0.000000, 7.426794], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("2 (1/2-) ->  3 (1/2-)", [14993.45, 14994.08,  1.312650, 0.000000, 1.312650], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("3 (1/2-) ->  2 (1/2-)", [14994.08, 14993.45,  1.312650, 0.000000, 1.312650], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("3 (1/2-) ->  3 (1/2-)", [14994.08, 14994.08,  1.485017, 0.000000, 1.485017], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (3/2+) ->  1 (3/2+)", [14994.08, 14994.08, -4.455052, 0.000000, 4.455052], [1e-2,1e-2,1e-5,1e-5,1e-5]),
    Filter("1 (3/2-) ->  1 (3/2-)", [14994.08, 14994.08,  4.455052, 0.000000, 4.455052], [1e-2,1e-2,1e-5,1e-5,1e-5])
]).run("--no-clean")

execute("rm -rf MRCONEE* MDCINT* MDPROP* scratch")

